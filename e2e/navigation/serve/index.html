<!DOCTYPE html>
<html>
  <head>
    <title>test</title>
    <script src="bugsnag.dist.js"></script>
    <script>
      try {
        var reports = []
        var client = bugsnag({
          apiKey: 'aaaa-aaaa-aaaa-aaaa',
          endpoints: { notify: 'http://localhost:55854', sessions: 'http://localhost:55854/sessions' }
        })
        client.transport({
          sendReport: function (logger, config, report) {
            reports.push(report)
          },
          sendSession: function (logger, config, session) {}
        })
      } catch (e) {
        window.parent.postMessage(JSON.stringify({ type: 'error', error: e }), '*')
      }
    </script>
  </head>
  <body>
    <script>
      setTimeout(function () {
        try {
          window.parent.postMessage(JSON.stringify({ type: 'data', reports: reports }), '*')
        } catch (e) {
          window.parent.postMessage(JSON.stringify({ type: 'error', error: e }), '*')
        }
      })
      window.history.pushState({}, '', '/234235')
      throw new Error('floop')
    </script>
  </body>
</html>
